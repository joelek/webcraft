(()=>{"use strict";({473:function(){var e,t,r,i,n,s=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,s){function a(e){try{o(i.next(e))}catch(e){s(e)}}function f(e){try{o(i.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,f)}o((i=i.apply(e,t||[])).next())}))};!function(e){e.absent=function(e){return null==e},e.present=function(e){return null!=e}}(e||(e={})),function(e){e.between=function(e,t,r){if(t<e||t>r)throw`Expected ${t} to be an integer between ${e} and ${r}!`},e.identical=function(e,t){if(e!==t)throw`Expected ${e} to be identical to ${t}!`}}(t||(t={}));class a{constructor(e){this.buffer=e}read(e,t,r,i){return s(this,void 0,void 0,(function*(){r=null!=r?r:0,i=null!=i?i:t.byteLength-r;let n=this.buffer.slice(e,e+i),s=new Uint8Array(n);return new Uint8Array(t,r,i).set(s,0),i}))}size(){return this.buffer.byteLength}}class f{constructor(e){this.file=e}buffer(){return s(this,void 0,void 0,(function*(){let e=new ArrayBuffer(this.size());return yield this.read(0,e),new a(e)}))}read(e,r,i,n){return s(this,void 0,void 0,(function*(){i=null!=i?i:0,n=null!=n?n:r.byteLength-i,t.between(0,i,r.byteLength),t.between(0,n,r.byteLength-i);let s=this.file.slice(e,e+n),a=new Uint8Array(yield s.arrayBuffer());return new Uint8Array(r,i,n).set(a,0),n}))}size(){return this.file.size}}class o{constructor(e,r=new ArrayBuffer(1),i=0){t.between(0,i,r.byteLength-1),this.endianness=e,this.view=new DataView(r,i,1)}get value(){return this.view.getUint8(0)}set value(e){let t=this.value;if(this.view.setUint8(0,e),this.value!==e)throw this.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.view.buffer,this.view.byteOffset,this.view.byteLength)),r}))}}class u{constructor(e,r=new ArrayBuffer(2),i=0){t.between(0,i,r.byteLength-2),this.endianness=e,this.view=new DataView(r,i,2)}get value(){return this.view.getUint16(0,"LittleEndian"===this.endianness)}set value(e){let t=this.value;if(this.view.setUint16(0,e,"LittleEndian"===this.endianness),this.value!==e)throw this.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.view.buffer,this.view.byteOffset,this.view.byteLength)),r}))}}class l{constructor(e,r=new ArrayBuffer(4),i=0){t.between(0,i,r.byteLength-4),this.endianness=e,this.view=new DataView(r,i,4)}get value(){return this.view.getUint32(0,"LittleEndian"===this.endianness)}set value(e){let t=this.value;if(this.view.setUint32(0,e,"LittleEndian"===this.endianness),this.value!==e)throw this.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.view.buffer,this.view.byteOffset,this.view.byteLength)),r}))}}class h{constructor(e,r,i){t.between(0,r,15),t.between(1,i,16-r),this.integer=e,this.offset=r,this.length=i}get value(){let e=16-(this.offset+this.length),t=16-this.length;return this.integer.value<<e>>>t}set value(e){let t=this.integer.value,r=this.offset,i=65535>>r<<16-this.length>>>16-(this.offset+this.length);if(this.integer.value=(this.integer.value&~i|e<<r&i)>>>0,this.value!==e)throw this.integer.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}}class d{constructor(e,r,i){t.between(0,r,31),t.between(1,i,32-r),this.integer=e,this.offset=r,this.length=i}get value(){let e=32-(this.offset+this.length),t=32-this.length;return this.integer.value<<e>>>t}set value(e){let t=this.integer.value,r=this.offset,i=4294967295>>r<<32-this.length>>>32-(this.offset+this.length);if(this.integer.value=(this.integer.value&~i|e<<r&i)>>>0,this.value!==e)throw this.integer.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}}class c{constructor(e){this.buffer=new ArrayBuffer(8),this.version=new l(e,this.buffer,0),this.recordCount=new l(e,this.buffer,4)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}class p{constructor(e){this.buffer=new ArrayBuffer(4);let t=new l(e,this.buffer,0);this.uncompressedSize=new d(t,0,24),this.isCompressed=new d(t,29,1)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}class E{constructor(e,t){this.dataProvider=e,this.endianness=t}decompress(e,t){return s(this,void 0,void 0,(function*(){let r=new Uint8Array(t),i=8,n=0,s=new Uint8Array(1),a=new Uint8Array(1),f=new Uint8Array(4096),o=0;function l(e){f[o]=e,o+=1,o%=4096,r[n]=e,n+=1}let d=new u(this.endianness),c=new h(d,0,12),p=new h(d,12,4);for(;n<t.byteLength;){i>=8&&(e+=(yield this.dataProvider.read(e,s.buffer)),i=0);let t=s[0]>>i&1;if(i+=1,t)e+=(yield this.dataProvider.read(e,a.buffer)),l(a[0]);else{e+=(yield d.load(e,this.dataProvider));let t=c.value,r=p.value+3;for(let e=t;e<t+r;e++)l(f[e%4096])}}}))}getRecord(e){return s(this,void 0,void 0,(function*(){let r=new c(this.endianness),i=0;i+=(yield r.load(i,this.dataProvider)),t.between(0,e,r.recordCount.value-1),i+=4*e;let n=new l(this.endianness);i+=(yield n.load(i,this.dataProvider));let s=new p(this.endianness);i=n.value,i+=(yield s.load(i,this.dataProvider));let f=new ArrayBuffer(s.uncompressedSize.value);return s.isCompressed.value?yield this.decompress(i,f):yield this.dataProvider.read(i,f),new a(f)}))}}!function(e){e[e.PCM_8BIT_UNSIGNED=0]="PCM_8BIT_UNSIGNED",e[e.CREATIVE_ADPCM_4BIT_8BIT=1]="CREATIVE_ADPCM_4BIT_8BIT",e[e.CREATIVE_ADPCM_3BIT_8BIT=2]="CREATIVE_ADPCM_3BIT_8BIT",e[e.CREATIVE_ADPCM_2BIT_8BIT=3]="CREATIVE_ADPCM_2BIT_8BIT",e[e.PCM_16BIT_SIGNED=4]="PCM_16BIT_SIGNED",e[e.UNKNOWN=5]="UNKNOWN",e[e.ALAW=6]="ALAW",e[e.ULAW=7]="ULAW"}(r||(r={})),function(e){e[e.TERMINATOR=0]="TERMINATOR",e[e.SOUND_DATA=1]="SOUND_DATA",e[e.CONTINUED_SOUND_DATA=2]="CONTINUED_SOUND_DATA",e[e.SILENCE=3]="SILENCE",e[e.MARKER=4]="MARKER",e[e.TEXT=5]="TEXT",e[e.REPEAT_START=6]="REPEAT_START",e[e.REPEAT_END=7]="REPEAT_END",e[e.EXTRA_INFO=8]="EXTRA_INFO",e[e.NEW_SOUND_DATA=9]="NEW_SOUND_DATA"}(i||(i={})),function(r){class i{constructor(e){this.buffer=new ArrayBuffer(12),this.spawnOffset=new u(e,this.buffer,0),this.deathOffset=new u(e,this.buffer,2),this.idleOffset=new u(e,this.buffer,4),this.movementOffset=new u(e,this.buffer,6),this.actionOffset=new u(e,this.buffer,8),this.trainOffset=new u(e,this.buffer,10)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}r.UnitScriptHeader=i;class n{constructor(e){this.buffer=new ArrayBuffer(6),this.spawnOffset=new u(e,this.buffer,0),this.movementOffset=new u(e,this.buffer,2),this.hitOffset=new u(e,this.buffer,4)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}r.ParticleScriptHeader=n;class a{constructor(e){this.buffer=new ArrayBuffer(6),this.headerOffset=new u(e,this.buffer,0),this.unitScriptCount=new u(e,this.buffer,2),this.particleScriptCount=new u(e,this.buffer,4)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}r.ScriptHeader=a,r.Script=class{constructor(e){this.endianness=e,this.header=new a(e),this.unitScriptHeaders=new Array,this.particleScriptHeaders=new Array,this.buffer=new ArrayBuffer(0)}load(e){return s(this,void 0,void 0,(function*(){this.unitScriptHeaders.splice(0,this.unitScriptHeaders.length),this.particleScriptHeaders.splice(0,this.particleScriptHeaders.length);let t=0,r=new Array,s=new u(this.endianness);for(;;){if(t+=(yield s.load(t,e)),t-2===s.value){t-=2;break}r.push(s.value)}t+=(yield this.header.load(t,e));for(let t=0;t<this.header.unitScriptCount.value;t++){let n=r[t],s=new i(this.endianness);yield s.load(n,e),this.unitScriptHeaders.push(s)}for(let t=0;t<this.header.particleScriptCount.value;t++){let i=r[this.header.unitScriptCount.value+t],s=new n(this.endianness);yield s.load(i,e),this.particleScriptHeaders.push(s)}return this.buffer=new ArrayBuffer(e.size()),yield e.read(0,this.buffer),this}))}getUnitScript(e){return t.between(0,e,this.unitScriptHeaders.length-1),{header:this.unitScriptHeaders[e],buffer:this.buffer}}getParticle(e){return t.between(0,e,this.particleScriptHeaders.length-1),{header:this.particleScriptHeaders[e],buffer:this.buffer}}};class f{constructor(e){this.buffer=new ArrayBuffer(8),this.x=new o(e,this.buffer,0),this.y=new o(e,this.buffer,1),this.w=new o(e,this.buffer,2),this.h=new o(e,this.buffer,3),this.offset=new l(e,this.buffer,4)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}r.SpriteFrameHeader=f;class h{constructor(e){this.header=new f(e),this.buffer=new ArrayBuffer(0)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield this.header.load(e+r,t)),this.buffer=new ArrayBuffer(this.header.w.value*this.header.h.value),yield t.read(this.header.offset.value,this.buffer),r}))}makeTexture(t,r,i){let n=this.header.x.value,s=this.header.y.value,a=this.header.w.value,f=this.header.h.value,o=t.createTexture();if(e.absent(o))throw"Expected a texture!";return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,r,i,0,t.LUMINANCE,t.UNSIGNED_BYTE,null),t.texSubImage2D(t.TEXTURE_2D,0,n,s,a,f,t.LUMINANCE,t.UNSIGNED_BYTE,new Uint8Array(this.buffer)),o}}r.SpriteFrame=h;class d{constructor(e){this.buffer=new ArrayBuffer(4),this.spriteCount=new u(e,this.buffer,0),this.w=new o(e,this.buffer,2),this.h=new o(e,this.buffer,3)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}r.SpriteHeader=d,r.Sprite=class{constructor(e){this.endianness=e,this.header=new d(e),this.frames=new Array}load(e){return s(this,void 0,void 0,(function*(){this.frames.splice(0,this.frames.length);let t=0;t+=(yield this.header.load(t,e));for(let r=0;r<this.header.spriteCount.value;r++){let r=new h(this.endianness);t+=(yield r.load(t,e)),this.frames.push(r)}return this}))}makeTextures(e){let t=this.header.w.value,r=this.header.h.value,i=new Array;for(let n of this.frames){let s=n.makeTexture(e,t,r);i.push(s)}return i}},r.Map=class{constructor(e){this.buffer=new ArrayBuffer(0)}load(e){return s(this,void 0,void 0,(function*(){let t=0;return this.buffer=new ArrayBuffer(8192),t+=(yield e.read(t,this.buffer)),this}))}};class c{constructor(e){this.buffer=new ArrayBuffer(8),this.x=new u(e,this.buffer,0),this.y=new u(e,this.buffer,2),this.w=new u(e,this.buffer,4),this.h=new u(e,this.buffer,6)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}r.CursorHeader=c,r.Cursor=class{constructor(e){this.header=new c(e),this.buffer=new ArrayBuffer(0)}load(e){return s(this,void 0,void 0,(function*(){let t=0;return t+=(yield this.header.load(t,e)),this.buffer=new ArrayBuffer(this.header.w.value*this.header.h.value),t+=(yield e.read(t,this.buffer)),this}))}makeTexture(t){let r=this.header.w.value,i=this.header.h.value,n=t.createTexture();if(e.absent(n))throw"Expected a texture!";return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,r,i,0,t.LUMINANCE,t.UNSIGNED_BYTE,null),t.texSubImage2D(t.TEXTURE_2D,0,0,0,r,i,t.LUMINANCE,t.UNSIGNED_BYTE,new Uint8Array(this.buffer)),n}},r.Palette=class{constructor(e){this.buffer=new ArrayBuffer(0)}load(e){return s(this,void 0,void 0,(function*(){t.between(0,e.size()%3,0);let r=0;return this.buffer=new ArrayBuffer(e.size()),r+=(yield e.read(r,this.buffer)),this}))}makeTexture(t){let r=this.buffer.byteLength/3,i=t.createTexture();if(e.absent(i))throw"Expected a texture!";return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGB,256,1,0,t.RGB,t.UNSIGNED_BYTE,null),t.texSubImage2D(t.TEXTURE_2D,0,0,0,r,1,t.RGB,t.UNSIGNED_BYTE,new Uint8Array(this.buffer)),i}updateTexture(e,t){let r=this.buffer.byteLength/3;return T.activeTexture(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,e),T.texSubImage2D(T.TEXTURE_2D,0,t,0,r,1,T.RGB,T.UNSIGNED_BYTE,new Uint8Array(this.buffer)),this}};class p{constructor(e){this.buffer=new ArrayBuffer(4),this.w=new u(e,this.buffer,0),this.h=new u(e,this.buffer,2)}load(e,t){return s(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}r.BitmapHeader=p,r.Bitmap=class{constructor(e){this.header=new p(e),this.buffer=new ArrayBuffer(0)}load(e){return s(this,void 0,void 0,(function*(){let t=0;return t+=(yield this.header.load(t,e)),this.buffer=new ArrayBuffer(this.header.w.value*this.header.h.value),t+=(yield e.read(t,this.buffer)),this}))}makeTexture(t){let r=this.header.w.value,i=this.header.h.value,n=t.createTexture();if(e.absent(n))throw"Expected a texture!";return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,r,i,0,t.LUMINANCE,t.UNSIGNED_BYTE,null),t.texSubImage2D(t.TEXTURE_2D,0,0,0,r,i,t.LUMINANCE,t.UNSIGNED_BYTE,new Uint8Array(this.buffer)),n}}}(n||(n={}));let v=document.createElement("canvas"),T=v.getContext("webgl2");if(e.absent(T))throw"Expected a context!";T.clearColor(0,0,0,1),T.pixelStorei(T.UNPACK_ALIGNMENT,1);let m=T.createProgram();if(e.absent(m))throw"Expected a program!";let w=T.createShader(T.VERTEX_SHADER);if(e.absent(w))throw"Expected a shader!";if(T.shaderSource(w,"#version 300 es\n\tuniform ivec2 viewport;\n\tuniform bvec2 scaling;\n\tuniform vec2 anchor;\n\tuniform vec2 quad;\n\tuniform sampler2D paletteSampler;\n\tuniform sampler2D textureSampler;\n\tin vec2 vertexPosition;\n\tin vec2 vertexTexture;\n\tout vec2 textureCoordinates;\n\tvoid main() {\n\t\tfloat zoom = 4.0;\n\t\ttextureCoordinates = vertexTexture;\n\t\tif (scaling.x) {\n\t\t\ttextureCoordinates.x = 1.0 - textureCoordinates.x;\n\t\t}\n\t\tif (scaling.y) {\n\t\t\ttextureCoordinates.y = 1.0 - textureCoordinates.y;\n\t\t}\n\t\tivec2 texSize = textureSize(textureSampler, 0);\n\t\tvec2 vvpos = vec2(quad) + (vertexPosition - anchor) * vec2(texSize);\n\t\tmat3x3 transform = mat3x3(vec3(2.0 / float(viewport.x), 0.0, 0.0), vec3(0.0, -2.0 / float(viewport.y), 0.0), vec3(-1.0, 1.0, 1.0));\n\t\tgl_Position = vec4((transform * vec3(vvpos * zoom, 1.0)).xy, 0.0, 1.0);\n\t}\n"),T.compileShader(w),!T.getShaderParameter(w,T.COMPILE_STATUS))throw`${T.getShaderInfoLog(w)}`;let y=T.createShader(T.FRAGMENT_SHADER);if(e.absent(y))throw"Expected a shader!";if(T.shaderSource(y,"#version 300 es\n\tprecision highp float;\n\tuniform int transparentIndex;\n\tuniform sampler2D paletteSampler;\n\tuniform sampler2D textureSampler;\n\tin vec2 textureCoordinates;\n\tout vec4 fragmentColor;\n\tvoid main() {\n\t\tfloat index = texture(textureSampler, textureCoordinates).x;\n\t\tint indexInt = int(index * float(textureSize(textureSampler, 0).x));\n\t\tif (indexInt == transparentIndex) {\n\t\t\tdiscard;\n\t\t}\n\t\tvec3 color = texture(paletteSampler, vec2(index, 0.0)).rgb * 4.0;\n\t\tfragmentColor = vec4(color, 1.0);\n\t}\n"),T.compileShader(y),!T.getShaderParameter(y,T.COMPILE_STATUS))throw`${T.getShaderInfoLog(y)}`;if(T.attachShader(m,w),T.attachShader(m,y),T.linkProgram(m),!T.getProgramParameter(m,T.LINK_STATUS))throw`${T.getProgramInfoLog(m)}`;T.useProgram(m);let b=T.getUniformLocation(m,"viewport"),A=T.getUniformLocation(m,"quad"),_=T.getUniformLocation(m,"scaling"),g=T.getUniformLocation(m,"anchor"),U=T.getUniformLocation(m,"transparentIndex");T.uniform1i(U,0);let x=T.getUniformLocation(m,"textureSampler");T.uniform1i(x,0);let R=T.getUniformLocation(m,"paletteSampler");T.uniform1i(R,1);let S=T.getAttribLocation(m,"vertexPosition");T.enableVertexAttribArray(S);let D=T.getAttribLocation(m,"vertexTexture");T.enableVertexAttribArray(D);let P=T.createBuffer();if(e.absent(P))throw"Expected a buffer!";T.bindBuffer(T.ARRAY_BUFFER,P),T.bufferData(T.ARRAY_BUFFER,new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,1,0]),T.STATIC_DRAW),T.vertexAttribPointer(S,2,T.FLOAT,!1,16,0),T.vertexAttribPointer(D,2,T.FLOAT,!1,16,8),v.setAttribute("style","height: 100%; width: 100%;"),v.addEventListener("dragenter",(e=>s(void 0,void 0,void 0,(function*(){e.stopPropagation(),e.preventDefault()})))),v.addEventListener("dragover",(e=>s(void 0,void 0,void 0,(function*(){e.stopPropagation(),e.preventDefault()}))));let I,N="LittleEndian";function B(e){return s(this,void 0,void 0,(function*(){I=new E(e,N);let t=yield new n.Palette(N).load(yield I.getRecord(191)),r=yield t.makeTexture(T);(yield new n.Palette(N).load(yield I.getRecord(210))).updateTexture(r,128),T.activeTexture(T.TEXTURE1),T.bindTexture(T.TEXTURE_2D,r);try{yield H(I)}catch(e){try{yield W(I)}catch(e){}}}))}let C,L,O=[{name:"Footman",script:0,sprite:279},{name:"Grunt",script:1,sprite:280},{name:"Peasant",script:2,sprite:281},{name:"Peasant",script:2,sprite:327},{name:"Peasant",script:2,sprite:329},{name:"Peon",script:3,sprite:282},{name:"Peon",script:3,sprite:328},{name:"Peon",script:3,sprite:330},{name:"Catapult",script:4,sprite:283},{name:"Catapult",script:5,sprite:284},{name:"Knight",script:6,sprite:285},{name:"Raider",script:7,sprite:286},{name:"Archer",script:8,sprite:287},{name:"Spearman",script:9,sprite:288},{name:"Conjurer",script:10,sprite:289},{name:"Warlock",script:11,sprite:290},{name:"Cleric",script:12,sprite:291},{name:"Necrolyte",script:13,sprite:292},{name:"Medivh",script:14,sprite:293},{name:"Sir Lothar",script:15,sprite:294},{name:"Grunt (copy)",script:16,sprite:280},{name:"Griselda",script:17,sprite:296},{name:"Garona",script:18,sprite:296},{name:"Ogre",script:19,sprite:297},{name:"Ogre (copy)",script:20,sprite:297},{name:"Spider",script:21,sprite:298},{name:"Slime",script:22,sprite:299},{name:"Fire Elemental",script:23,sprite:300},{name:"Scorpion",script:24,sprite:301},{name:"Brigand",script:25,sprite:302},{name:"Skeleton",script:26,sprite:303},{name:"Skeleton",script:27,sprite:304},{name:"Daemon",script:28,sprite:305},{name:"Ogre (copy 2)",script:29,sprite:297},{name:"Ogre (copy 3)",script:30,sprite:297},{name:"Water Elemental",script:31,sprite:306},{name:"Farm",script:32,sprite:307},{name:"Farm",script:33,sprite:308},{name:"Barracks",script:34,sprite:309},{name:"Barracks",script:35,sprite:310},{name:"Church",script:36,sprite:311},{name:"Temple",script:37,sprite:312},{name:"Tower",script:38,sprite:313},{name:"Tower",script:39,sprite:314},{name:"Town Hall",script:40,sprite:315},{name:"Town Hall",script:41,sprite:316},{name:"Mill",script:42,sprite:317},{name:"Mill",script:43,sprite:318},{name:"Stables",script:44,sprite:319},{name:"Kennel",script:45,sprite:320},{name:"Blacksmith",script:46,sprite:321},{name:"Blacksmith",script:47,sprite:322},{name:"Stormwind Keep",script:48,sprite:323},{name:"Black Rock Spire",script:49,sprite:324},{name:"Gold Mine",script:50,sprite:325},{name:"Blob",script:0,type:"effect",sprite:347},{name:"Fire Ball",script:1,type:"effect",sprite:348},{name:"Spear",script:2,type:"effect",sprite:349},{name:"Poison Cloud",script:3,type:"effect",sprite:350},{name:"Catapult Projectile",script:4,type:"effect",sprite:351},{name:"Burning Small",script:5,type:"effect",sprite:352},{name:"Burning Medium",script:6,type:"effect",sprite:353},{name:"Explosion",script:7,type:"effect",sprite:354},{name:"Sparkle",script:8,type:"effect",sprite:355},{name:"Building Collapse",script:9,type:"effect",sprite:356},{name:"Water Elemental",script:10,type:"effect",sprite:357},{name:"Fire Elemental",script:11,type:"effect",sprite:358}],X=new Array,M=0,k=0,G=0,F=0;function H(e){return s(this,void 0,void 0,(function*(){let t=O[M],r=yield new n.Sprite(N).load(yield e.getRecord(t.sprite));X=yield r.makeTextures(T);let i=(yield new n.Script(N).load(yield e.getRecord(212))).getUnitScript(t.script);return console.log([t,i.header.spawnOffset.value,i.header.deathOffset.value,i.header.idleOffset.value,i.header.movementOffset.value,i.header.actionOffset.value,i.header.trainOffset.value]),L=new DataView(i.buffer),F=0,C=i.header.movementOffset.value,k=0,i.header}))}function W(e){return s(this,void 0,void 0,(function*(){let t=O[M],r=yield new n.Sprite(N).load(yield e.getRecord(t.sprite));X=yield r.makeTextures(T);let i=(yield new n.Script(N).load(yield e.getRecord(212))).getParticle(t.script);return console.log([t,i.header.spawnOffset.value,i.header.movementOffset.value,i.header.hitOffset.value]),L=new DataView(i.buffer),F=0,C=i.header.movementOffset.value,k=0,i.header}))}function $(){return s(this,void 0,void 0,(function*(){let e=v.offsetWidth*window.devicePixelRatio,t=v.offsetHeight*window.devicePixelRatio;v.setAttribute("width",`${e}px`),v.setAttribute("height",`${t}px`),T.viewport(0,0,e,t),T.uniform2i(b,e,t)}))}window.requestAnimationFrame((function t(r){if(T.clear(T.COLOR_BUFFER_BIT),e.present(C)&&e.present(L)){if(k>0)k-=1;else{let e=L.getUint8(C++);if(0===e);else if(1===e)k=L.getUint8(C++);else{if(2===e)throw"";if(3===e)C=L.getUint16(C,!0);else if(4===e)F=L.getUint8(C++);else if(5===e)L.getUint8(C++);else if(6===e)L.getUint8(C++),F=L.getUint8(C++);else if(7===e)k=L.getUint8(C++);else if(8===e)console.log("sound!");else if(9===e)console.log("damage!");else{if(10!==e)throw`Invalid opcode ${e}!`;k=L.getUint8(C++)}}}let e=G<5?F+G:F+8-G;X.length,T.uniform2f(g,.5,.5),T.uniform2f(A,48,48),T.uniform2i(_,G<5?0:1,0),T.activeTexture(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,X[e]),T.bindBuffer(T.ARRAY_BUFFER,P),T.drawArrays(T.TRIANGLES,0,6)}window.requestAnimationFrame(t)})),window.addEventListener("keyup",(t=>s(void 0,void 0,void 0,(function*(){if("8"===t.key?G=0:"9"===t.key?G=1:"6"===t.key?G=2:"3"===t.key?G=3:"2"===t.key?G=4:"1"===t.key?G=5:"4"===t.key?G=6:"7"===t.key&&(G=7),e.present(I))try{"a"===t.key?C=(yield H(I)).actionOffset.value:"d"===t.key?C=(yield H(I)).deathOffset.value:"i"===t.key?C=(yield H(I)).idleOffset.value:"m"===t.key?C=(yield H(I)).movementOffset.value:"s"===t.key?C=(yield H(I)).spawnOffset.value:"t"===t.key?C=(yield H(I)).trainOffset.value:"z"===t.key?C=(yield W(I)).spawnOffset.value:"x"===t.key?C=(yield W(I)).movementOffset.value:"c"===t.key?C=(yield W(I)).hitOffset.value:"ArrowUp"===t.key?(M=((M-1)%O.length+O.length)%O.length,"effect"===O[M].type?yield W(I):yield H(I)):"ArrowDown"===t.key&&(M=((M+1)%O.length+O.length)%O.length,"effect"===O[M].type?yield W(I):yield H(I))}catch(e){}})))),v.addEventListener("drop",(t=>s(void 0,void 0,void 0,(function*(){t.stopPropagation(),t.preventDefault();let r=t.dataTransfer;if(e.present(r)){let e=r.files;for(let t of e){let e=yield new f(t).buffer();yield B(e)}}})))),document.body.appendChild(v),window.addEventListener("resize",(()=>{$()})),$()}})[473]()})();