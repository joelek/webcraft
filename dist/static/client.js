(()=>{"use strict";var e={473:function(e,t,r){var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,a){function s(e){try{u(i.next(e))}catch(e){a(e)}}function o(e){try{u(i.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=r(413);var a,s,o,u,f;!function(e){e.absent=function(e){return null==e},e.present=function(e){return null!=e}}(a||(a={})),function(e){e.between=function(e,t,r){if(t<e||t>r)throw`Expected ${t} to be an integer between ${e} and ${r}!`},e.identical=function(e,t){if(e!==t)throw`Expected ${e} to be identical to ${t}!`}}(s||(s={}));class l{constructor(e){this.buffer=e}read(e,t,r,n){return i(this,void 0,void 0,(function*(){r=null!=r?r:0,n=null!=n?n:t.byteLength-r;let i=this.buffer.slice(e,e+n),a=new Uint8Array(i);return new Uint8Array(t,r,n).set(a,0),n}))}size(){return this.buffer.byteLength}}class d{constructor(e){this.file=e}buffer(){return i(this,void 0,void 0,(function*(){let e=new ArrayBuffer(this.size());return yield this.read(0,e),new l(e)}))}read(e,t,r,n){return i(this,void 0,void 0,(function*(){r=null!=r?r:0,n=null!=n?n:t.byteLength-r,s.between(0,r,t.byteLength),s.between(0,n,t.byteLength-r);let i=this.file.slice(e,e+n),a=new Uint8Array(yield i.arrayBuffer());return new Uint8Array(t,r,n).set(a,0),n}))}size(){return this.file.size}}class h{constructor(e,t=new ArrayBuffer(1),r=0){s.between(0,r,t.byteLength-1),this.endianness=e,this.view=new DataView(t,r,1)}get value(){return this.view.getUint8(0)}set value(e){let t=this.value;if(this.view.setUint8(0,e),this.value!==e)throw this.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.view.buffer,this.view.byteOffset,this.view.byteLength)),r}))}}class c{constructor(e,t=new ArrayBuffer(2),r=0){s.between(0,r,t.byteLength-2),this.endianness=e,this.view=new DataView(t,r,2)}get value(){return this.view.getUint16(0,"LittleEndian"===this.endianness)}set value(e){let t=this.value;if(this.view.setUint16(0,e,"LittleEndian"===this.endianness),this.value!==e)throw this.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.view.buffer,this.view.byteOffset,this.view.byteLength)),r}))}}class p{constructor(e,t=new ArrayBuffer(4),r=0){s.between(0,r,t.byteLength-4),this.endianness=e,this.view=new DataView(t,r,4)}get value(){return this.view.getUint32(0,"LittleEndian"===this.endianness)}set value(e){let t=this.value;if(this.view.setUint32(0,e,"LittleEndian"===this.endianness),this.value!==e)throw this.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.view.buffer,this.view.byteOffset,this.view.byteLength)),r}))}}class E{constructor(e,t,r){s.between(0,t,15),s.between(1,r,16-t),this.integer=e,this.offset=t,this.length=r}get value(){let e=16-(this.offset+this.length),t=16-this.length;return this.integer.value<<e>>>t}set value(e){let t=this.integer.value,r=this.offset,i=65535>>r<<16-this.length>>>16-(this.offset+this.length);if(this.integer.value=(this.integer.value&~i|e<<r&i)>>>0,this.value!==e)throw this.integer.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}}class T{constructor(e,t,r){s.between(0,t,31),s.between(1,r,32-t),this.integer=e,this.offset=t,this.length=r}get value(){let e=32-(this.offset+this.length),t=32-this.length;return this.integer.value<<e>>>t}set value(e){let t=this.integer.value,r=this.offset,i=4294967295>>r<<32-this.length>>>32-(this.offset+this.length);if(this.integer.value=(this.integer.value&~i|e<<r&i)>>>0,this.value!==e)throw this.integer.value=t,`Unexpectedly encoded ${e} as ${this.value}!`}}class v{constructor(e){this.buffer=new ArrayBuffer(8),this.version=new p(e,this.buffer,0),this.recordCount=new p(e,this.buffer,4)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}class m{constructor(e){this.buffer=new ArrayBuffer(4);let t=new p(e,this.buffer,0);this.uncompressedSize=new T(t,0,24),this.isCompressed=new T(t,29,1)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}class w{constructor(e,t){this.dataProvider=e,this.endianness=t}decompress(e,t){return i(this,void 0,void 0,(function*(){let r=new Uint8Array(t),i=8,n=0,a=new Uint8Array(1),s=new Uint8Array(1),o=new Uint8Array(4096),u=0;function f(e){o[u]=e,u+=1,u%=4096,r[n]=e,n+=1}let l=new c(this.endianness),d=new E(l,0,12),h=new E(l,12,4);for(;n<t.byteLength;){i>=8&&(e+=(yield this.dataProvider.read(e,a.buffer)),i=0);let t=a[0]>>i&1;if(i+=1,t)e+=(yield this.dataProvider.read(e,s.buffer)),f(s[0]);else{e+=(yield l.load(e,this.dataProvider));let t=d.value,r=h.value+3;for(let e=t;e<t+r;e++)f(o[e%4096])}}}))}getRecord(e){return i(this,void 0,void 0,(function*(){let t=new v(this.endianness),r=0;r+=(yield t.load(r,this.dataProvider)),s.between(0,e,t.recordCount.value-1),r+=4*e;let i=new p(this.endianness);r+=(yield i.load(r,this.dataProvider));let n=new m(this.endianness);r=i.value,r+=(yield n.load(r,this.dataProvider));let a=new ArrayBuffer(n.uncompressedSize.value);return n.isCompressed.value?yield this.decompress(r,a):yield this.dataProvider.read(r,a),new l(a)}))}}!function(e){e[e.PCM_8BIT_UNSIGNED=0]="PCM_8BIT_UNSIGNED",e[e.CREATIVE_ADPCM_4BIT_8BIT=1]="CREATIVE_ADPCM_4BIT_8BIT",e[e.CREATIVE_ADPCM_3BIT_8BIT=2]="CREATIVE_ADPCM_3BIT_8BIT",e[e.CREATIVE_ADPCM_2BIT_8BIT=3]="CREATIVE_ADPCM_2BIT_8BIT",e[e.PCM_16BIT_SIGNED=4]="PCM_16BIT_SIGNED",e[e.UNKNOWN=5]="UNKNOWN",e[e.ALAW=6]="ALAW",e[e.ULAW=7]="ULAW"}(o||(o={})),function(e){e[e.TERMINATOR=0]="TERMINATOR",e[e.SOUND_DATA=1]="SOUND_DATA",e[e.CONTINUED_SOUND_DATA=2]="CONTINUED_SOUND_DATA",e[e.SILENCE=3]="SILENCE",e[e.MARKER=4]="MARKER",e[e.TEXT=5]="TEXT",e[e.REPEAT_START=6]="REPEAT_START",e[e.REPEAT_END=7]="REPEAT_END",e[e.EXTRA_INFO=8]="EXTRA_INFO",e[e.NEW_SOUND_DATA=9]="NEW_SOUND_DATA"}(u||(u={})),function(e){class t{constructor(e){this.buffer=new ArrayBuffer(12),this.spawnOffset=new c(e,this.buffer,0),this.deathOffset=new c(e,this.buffer,2),this.idleOffset=new c(e,this.buffer,4),this.movementOffset=new c(e,this.buffer,6),this.actionOffset=new c(e,this.buffer,8),this.trainOffset=new c(e,this.buffer,10)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}e.UnitScriptHeader=t;class r{constructor(e){this.buffer=new ArrayBuffer(6),this.spawnOffset=new c(e,this.buffer,0),this.movementOffset=new c(e,this.buffer,2),this.hitOffset=new c(e,this.buffer,4)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}e.ParticleScriptHeader=r;class n{constructor(e){this.buffer=new ArrayBuffer(6),this.headerOffset=new c(e,this.buffer,0),this.unitScriptCount=new c(e,this.buffer,2),this.particleScriptCount=new c(e,this.buffer,4)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}e.ScriptHeader=n,e.Script=class{constructor(e){this.endianness=e,this.header=new n(e),this.unitScriptHeaders=new Array,this.particleScriptHeaders=new Array,this.buffer=new ArrayBuffer(0)}load(e){return i(this,void 0,void 0,(function*(){this.unitScriptHeaders.splice(0,this.unitScriptHeaders.length),this.particleScriptHeaders.splice(0,this.particleScriptHeaders.length);let i=0,n=new Array,a=new c(this.endianness);for(;;){if(i+=(yield a.load(i,e)),i-2===a.value){i-=2;break}n.push(a.value)}i+=(yield this.header.load(i,e));for(let r=0;r<this.header.unitScriptCount.value;r++){let i=n[r],a=new t(this.endianness);yield a.load(i,e),this.unitScriptHeaders.push(a)}for(let t=0;t<this.header.particleScriptCount.value;t++){let i=n[this.header.unitScriptCount.value+t],a=new r(this.endianness);yield a.load(i,e),this.particleScriptHeaders.push(a)}return this.buffer=new ArrayBuffer(e.size()),yield e.read(0,this.buffer),this}))}getUnitScript(e){return s.between(0,e,this.unitScriptHeaders.length-1),{header:this.unitScriptHeaders[e],buffer:this.buffer}}getParticle(e){return s.between(0,e,this.particleScriptHeaders.length-1),{header:this.particleScriptHeaders[e],buffer:this.buffer}}};class o{constructor(e){this.buffer=new ArrayBuffer(8),this.x=new h(e,this.buffer,0),this.y=new h(e,this.buffer,1),this.w=new h(e,this.buffer,2),this.h=new h(e,this.buffer,3),this.offset=new p(e,this.buffer,4)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}e.SpriteFrameHeader=o;class u{constructor(e){this.header=new o(e),this.buffer=new ArrayBuffer(0)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield this.header.load(e+r,t)),this.buffer=new ArrayBuffer(this.header.w.value*this.header.h.value),yield t.read(this.header.offset.value,this.buffer),r}))}makeTexture(e,t,r){let i=this.header.x.value,n=this.header.y.value,s=this.header.w.value,o=this.header.h.value,u=e.createTexture();if(a.absent(u))throw"Expected a texture!";return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t,r,0,e.LUMINANCE,e.UNSIGNED_BYTE,null),e.texSubImage2D(e.TEXTURE_2D,0,i,n,s,o,e.LUMINANCE,e.UNSIGNED_BYTE,new Uint8Array(this.buffer)),u}}e.SpriteFrame=u;class f{constructor(e){this.buffer=new ArrayBuffer(4),this.spriteCount=new c(e,this.buffer,0),this.w=new h(e,this.buffer,2),this.h=new h(e,this.buffer,3)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}e.SpriteHeader=f,e.Sprite=class{constructor(e){this.endianness=e,this.header=new f(e),this.frames=new Array}load(e){return i(this,void 0,void 0,(function*(){this.frames.splice(0,this.frames.length);let t=0;t+=(yield this.header.load(t,e));for(let r=0;r<this.header.spriteCount.value;r++){let r=new u(this.endianness);t+=(yield r.load(t,e)),this.frames.push(r)}return this}))}makeTextures(e){let t=this.header.w.value,r=this.header.h.value,i=new Array;for(let n of this.frames){let a=n.makeTexture(e,t,r);i.push(a)}return i}},e.Map=class{constructor(e){this.buffer=new ArrayBuffer(0)}load(e){return i(this,void 0,void 0,(function*(){let t=0;return this.buffer=new ArrayBuffer(8192),t+=(yield e.read(t,this.buffer)),this}))}};class l{constructor(e){this.buffer=new ArrayBuffer(8),this.x=new c(e,this.buffer,0),this.y=new c(e,this.buffer,2),this.w=new c(e,this.buffer,4),this.h=new c(e,this.buffer,6)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}e.CursorHeader=l,e.Cursor=class{constructor(e){this.header=new l(e),this.buffer=new ArrayBuffer(0)}load(e){return i(this,void 0,void 0,(function*(){let t=0;return t+=(yield this.header.load(t,e)),this.buffer=new ArrayBuffer(this.header.w.value*this.header.h.value),t+=(yield e.read(t,this.buffer)),this}))}makeTexture(e){let t=this.header.w.value,r=this.header.h.value,i=e.createTexture();if(a.absent(i))throw"Expected a texture!";return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t,r,0,e.LUMINANCE,e.UNSIGNED_BYTE,null),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t,r,e.LUMINANCE,e.UNSIGNED_BYTE,new Uint8Array(this.buffer)),i}},e.Palette=class{constructor(e){this.buffer=new ArrayBuffer(0)}load(e){return i(this,void 0,void 0,(function*(){s.between(0,e.size()%3,0);let t=0;return this.buffer=new ArrayBuffer(e.size()),t+=(yield e.read(t,this.buffer)),this}))}makeTexture(e){let t=this.buffer.byteLength/3,r=e.createTexture();if(a.absent(r))throw"Expected a texture!";return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGB,256,1,0,e.RGB,e.UNSIGNED_BYTE,null),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t,1,e.RGB,e.UNSIGNED_BYTE,new Uint8Array(this.buffer)),r}updateTexture(e,t){let r=this.buffer.byteLength/3;return A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,e),A.texSubImage2D(A.TEXTURE_2D,0,t,0,r,1,A.RGB,A.UNSIGNED_BYTE,new Uint8Array(this.buffer)),this}};class d{constructor(e){this.buffer=new ArrayBuffer(4),this.w=new c(e,this.buffer,0),this.h=new c(e,this.buffer,2)}load(e,t){return i(this,void 0,void 0,(function*(){let r=0;return r+=(yield t.read(e+r,this.buffer)),r}))}}e.BitmapHeader=d,e.Bitmap=class{constructor(e){this.header=new d(e),this.buffer=new ArrayBuffer(0)}load(e){return i(this,void 0,void 0,(function*(){let t=0;return t+=(yield this.header.load(t,e)),this.buffer=new ArrayBuffer(this.header.w.value*this.header.h.value),t+=(yield e.read(t,this.buffer)),this}))}makeTexture(e){let t=this.header.w.value,r=this.header.h.value,i=e.createTexture();if(a.absent(i))throw"Expected a texture!";return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,t,r,0,e.LUMINANCE,e.UNSIGNED_BYTE,null),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t,r,e.LUMINANCE,e.UNSIGNED_BYTE,new Uint8Array(this.buffer)),i}}}(f||(f={}));let y=document.createElement("canvas"),A=y.getContext("webgl2");if(a.absent(A))throw"Expected a context!";A.clearColor(0,0,0,1),A.pixelStorei(A.UNPACK_ALIGNMENT,1);let b=A.createProgram();if(a.absent(b))throw"Expected a program!";let _=A.createShader(A.VERTEX_SHADER);if(a.absent(_))throw"Expected a shader!";if(A.shaderSource(_,"#version 300 es\n\tuniform ivec2 viewport;\n\tuniform bvec2 scaling;\n\tuniform vec2 anchor;\n\tuniform vec2 quad;\n\tuniform sampler2D paletteSampler;\n\tuniform sampler2D textureSampler;\n\tin vec2 vertexPosition;\n\tin vec2 vertexTexture;\n\tout vec2 textureCoordinates;\n\tvoid main() {\n\t\tfloat zoom = 4.0;\n\t\ttextureCoordinates = vertexTexture;\n\t\tif (scaling.x) {\n\t\t\ttextureCoordinates.x = 1.0 - textureCoordinates.x;\n\t\t}\n\t\tif (scaling.y) {\n\t\t\ttextureCoordinates.y = 1.0 - textureCoordinates.y;\n\t\t}\n\t\tivec2 texSize = textureSize(textureSampler, 0);\n\t\tvec2 vvpos = vec2(quad) + (vertexPosition - anchor) * vec2(texSize);\n\t\tmat3x3 transform = mat3x3(vec3(2.0 / float(viewport.x), 0.0, 0.0), vec3(0.0, -2.0 / float(viewport.y), 0.0), vec3(-1.0, 1.0, 1.0));\n\t\tgl_Position = vec4((transform * vec3(vvpos * zoom, 1.0)).xy, 0.0, 1.0);\n\t}\n"),A.compileShader(_),!A.getShaderParameter(_,A.COMPILE_STATUS))throw`${A.getShaderInfoLog(_)}`;let g=A.createShader(A.FRAGMENT_SHADER);if(a.absent(g))throw"Expected a shader!";if(A.shaderSource(g,"#version 300 es\n\tprecision highp float;\n\tuniform int transparentIndex;\n\tuniform sampler2D colorCycleSampler;\n\tuniform sampler2D paletteSampler;\n\tuniform sampler2D textureSampler;\n\tin vec2 textureCoordinates;\n\tout vec4 fragmentColor;\n\tvoid main() {\n\t\tfloat index = texture(textureSampler, textureCoordinates).x;\n\t\tint indexInt = int(index * float(textureSize(textureSampler, 0).x));\n\t\tif (indexInt == transparentIndex) {\n\t\t\tdiscard;\n\t\t}\n\t\tfloat shiftedIndex = texture(colorCycleSampler, vec2(index, 0.0)).x;\n\t\tvec3 color = texture(paletteSampler, vec2(shiftedIndex, 0.0)).rgb * 4.0;\n\t\tfragmentColor = vec4(color, 1.0);\n\t}\n"),A.compileShader(g),!A.getShaderParameter(g,A.COMPILE_STATUS))throw`${A.getShaderInfoLog(g)}`;if(A.attachShader(b,_),A.attachShader(b,g),A.linkProgram(b),!A.getProgramParameter(b,A.LINK_STATUS))throw`${A.getProgramInfoLog(b)}`;A.useProgram(b);let U=A.getUniformLocation(b,"viewport"),x=A.getUniformLocation(b,"quad"),R=A.getUniformLocation(b,"scaling"),S=A.getUniformLocation(b,"anchor"),D=A.getUniformLocation(b,"transparentIndex");A.uniform1i(D,0);let P=A.getUniformLocation(b,"textureSampler");A.uniform1i(P,0);let I=A.getUniformLocation(b,"paletteSampler");A.uniform1i(I,1);let N=A.getUniformLocation(b,"colorCycleSampler");A.uniform1i(N,2);let C=A.getAttribLocation(b,"vertexPosition");A.enableVertexAttribArray(C);let L=A.getAttribLocation(b,"vertexTexture");A.enableVertexAttribArray(L);let B=A.createBuffer();if(a.absent(B))throw"Expected a buffer!";A.bindBuffer(A.ARRAY_BUFFER,B),A.bufferData(A.ARRAY_BUFFER,new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,1,0]),A.STATIC_DRAW),A.vertexAttribPointer(C,2,A.FLOAT,!1,16,0),A.vertexAttribPointer(L,2,A.FLOAT,!1,16,8),y.setAttribute("style","height: 100%; width: 100%;"),y.addEventListener("dragenter",(e=>i(void 0,void 0,void 0,(function*(){e.stopPropagation(),e.preventDefault()})))),y.addEventListener("dragover",(e=>i(void 0,void 0,void 0,(function*(){e.stopPropagation(),e.preventDefault()}))));let X,O="LittleEndian";function M(e){return i(this,void 0,void 0,(function*(){X=new w(e,O);let t=yield new f.Palette(O).load(yield X.getRecord(191)),r=yield t.makeTexture(A);(yield new f.Palette(O).load(yield X.getRecord(210))).updateTexture(r,128),A.activeTexture(A.TEXTURE1),A.bindTexture(A.TEXTURE_2D,r);try{yield K(X)}catch(e){try{yield q(X)}catch(e){}}}))}let k=[{name:"Footman",script:0,sprite:279},{name:"Grunt",script:1,sprite:280},{name:"Peasant",script:2,sprite:281},{name:"Peon",script:3,sprite:282},{name:"Catapult",script:4,sprite:283},{name:"Catapult",script:5,sprite:284},{name:"Knight",script:6,sprite:285},{name:"Raider",script:7,sprite:286},{name:"Archer",script:8,sprite:287},{name:"Spearman",script:9,sprite:288},{name:"Conjurer",script:10,sprite:289},{name:"Warlock",script:11,sprite:290},{name:"Cleric",script:12,sprite:291},{name:"Necrolyte",script:13,sprite:292},{name:"Medivh",script:14,sprite:293},{name:"Sir Lothar",script:15,sprite:294},{name:"Grunt (copy)",script:16,sprite:280},{name:"Griselda",script:17,sprite:296},{name:"Garona",script:18,sprite:296},{name:"Ogre",script:19,sprite:297},{name:"Ogre (copy)",script:20,sprite:297},{name:"Spider",script:21,sprite:298},{name:"Slime",script:22,sprite:299},{name:"Fire Elemental",script:23,sprite:300},{name:"Scorpion",script:24,sprite:301},{name:"Brigand",script:25,sprite:302},{name:"Skeleton",script:26,sprite:303},{name:"Skeleton",script:27,sprite:304},{name:"Daemon",script:28,sprite:305},{name:"Ogre (copy 2)",script:29,sprite:297},{name:"Ogre (copy 3)",script:30,sprite:297},{name:"Water Elemental",script:31,sprite:306},{name:"Farm",script:32,sprite:307},{name:"Farm",script:33,sprite:308},{name:"Barracks",script:34,sprite:309},{name:"Barracks",script:35,sprite:310},{name:"Church",script:36,sprite:311},{name:"Temple",script:37,sprite:312},{name:"Tower",script:38,sprite:313},{name:"Tower",script:39,sprite:314},{name:"Town Hall",script:40,sprite:315},{name:"Town Hall",script:41,sprite:316},{name:"Mill",script:42,sprite:317},{name:"Mill",script:43,sprite:318},{name:"Stables",script:44,sprite:319},{name:"Kennel",script:45,sprite:320},{name:"Blacksmith",script:46,sprite:321},{name:"Blacksmith",script:47,sprite:322},{name:"Stormwind Keep",script:48,sprite:323},{name:"Black Rock Spire",script:49,sprite:324},{name:"Gold Mine",script:50,sprite:325},{name:"Blob",script:0,type:"effect",sprite:347},{name:"Fire Ball",script:1,type:"effect",sprite:348},{name:"Spear",script:2,type:"effect",sprite:349},{name:"Poison Cloud",script:3,type:"effect",sprite:350},{name:"Catapult Projectile",script:4,type:"effect",sprite:351},{name:"Burning Small",script:5,type:"effect",sprite:352},{name:"Burning Medium",script:6,type:"effect",sprite:353},{name:"Explosion",script:7,type:"effect",sprite:354},{name:"Sparkle",script:8,type:"effect",sprite:355},{name:"Building Collapse",script:9,type:"effect",sprite:356},{name:"Water Elemental",script:10,type:"effect",sprite:357},{name:"Fire Elemental",script:11,type:"effect",sprite:358},{name:"Peasant",script:2,sprite:327},{name:"Peasant",script:2,sprite:329},{name:"Peon",script:3,sprite:328},{name:"Peon",script:3,sprite:330}],G=A.createTexture(),F=new Uint8Array(256);for(let e=0;e<256;e++)F[e]=e;if(a.absent(G))throw"Expected a texture!";A.activeTexture(A.TEXTURE2),A.bindTexture(A.TEXTURE_2D,G),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.texImage2D(A.TEXTURE_2D,0,A.LUMINANCE,256,1,0,A.LUMINANCE,A.UNSIGNED_BYTE,F);let H,W,$=new Array,z=0,V=0,Y=0,j=0;function K(e){return i(this,void 0,void 0,(function*(){let t=k[z],r=yield new f.Sprite(O).load(yield e.getRecord(t.sprite));$=yield r.makeTextures(A);let i=(yield new f.Script(O).load(yield e.getRecord(212))).getUnitScript(t.script);return console.log(JSON.stringify(Object.assign(Object.assign({},t),{armor:n.armor[z],armorPiercingDamage:n.armorPiercingDamage[z],damage:n.damage[z],goldCost:10*n.goldCost[z],health:n.health[z],productionTime:n.productionTime[z],range:n.range[z],unknown:n.unknown[z],woodCost:10*n.woodCost[z]})),null,"\t"),W=new DataView(i.buffer),j=0,H=i.header.movementOffset.value,V=0,i.header}))}function q(e){return i(this,void 0,void 0,(function*(){let t=k[z],r=yield new f.Sprite(O).load(yield e.getRecord(t.sprite));$=yield r.makeTextures(A);let i=(yield new f.Script(O).load(yield e.getRecord(212))).getParticle(t.script);return console.log(Object.assign({},t)),W=new DataView(i.buffer),j=0,H=i.header.movementOffset.value,V=0,i.header}))}function J(){return i(this,void 0,void 0,(function*(){let e=y.offsetWidth*window.devicePixelRatio,t=y.offsetHeight*window.devicePixelRatio;y.setAttribute("width",`${e}px`),y.setAttribute("height",`${t}px`),A.viewport(0,0,e,t),A.uniform2i(U,e,t)}))}window.requestAnimationFrame((function e(t){if(A.clear(A.COLOR_BUFFER_BIT),function(){let e=F[112];for(let e=112;e<119;e++)F[e]=F[e+1];F[119]=e,A.activeTexture(A.TEXTURE2),A.bindTexture(A.TEXTURE_2D,G),A.texSubImage2D(A.TEXTURE_2D,0,112,0,8,1,A.LUMINANCE,A.UNSIGNED_BYTE,F,112)}(),a.present(H)&&a.present(W)){if(V>0)V-=1;else{let e=W.getUint8(H++);if(0===e);else if(1===e)V=W.getUint8(H++);else{if(2===e)throw"";if(3===e)H=W.getUint16(H,!0);else if(4===e)j=W.getUint8(H++);else if(5===e)W.getUint8(H++);else if(6===e)W.getUint8(H++),j=W.getUint8(H++);else if(7===e)V=W.getUint8(H++);else if(8===e)console.log("sound!");else if(9===e)console.log("damage!");else{if(10!==e)throw`Invalid opcode ${e}!`;V=W.getUint8(H++)}}}let e=Y<5?j+Y:j+8-Y;$.length,A.uniform2f(S,.5,.5),A.uniform2f(x,48,48),A.uniform2i(R,Y<5?0:1,0),A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,$[e]),A.bindBuffer(A.ARRAY_BUFFER,B),A.drawArrays(A.TRIANGLES,0,6)}window.requestAnimationFrame(e)})),window.addEventListener("keyup",(e=>i(void 0,void 0,void 0,(function*(){if("8"===e.key?Y=0:"9"===e.key?Y=1:"6"===e.key?Y=2:"3"===e.key?Y=3:"2"===e.key?Y=4:"1"===e.key?Y=5:"4"===e.key?Y=6:"7"===e.key&&(Y=7),a.present(X))try{"a"===e.key?H=(yield K(X)).actionOffset.value:"d"===e.key?H=(yield K(X)).deathOffset.value:"i"===e.key?H=(yield K(X)).idleOffset.value:"m"===e.key?H=(yield K(X)).movementOffset.value:"s"===e.key?H=(yield K(X)).spawnOffset.value:"t"===e.key?H=(yield K(X)).trainOffset.value:"z"===e.key?H=(yield q(X)).spawnOffset.value:"x"===e.key?H=(yield q(X)).movementOffset.value:"c"===e.key?H=(yield q(X)).hitOffset.value:"ArrowUp"===e.key?(z=((z-1)%k.length+k.length)%k.length,"effect"===k[z].type?yield q(X):yield K(X)):"ArrowDown"===e.key&&(z=((z+1)%k.length+k.length)%k.length,"effect"===k[z].type?yield q(X):yield K(X))}catch(e){}})))),y.addEventListener("drop",(e=>i(void 0,void 0,void 0,(function*(){e.stopPropagation(),e.preventDefault();let t=e.dataTransfer;if(a.present(t)){let e=t.files;for(let t of e){let e=yield new d(t).buffer();yield M(e)}}})))),document.body.appendChild(y),window.addEventListener("resize",(()=>{J()})),J()},413:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(455),t)},455:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.armorPiercingDamage=t.damage=t.armor=t.range=t.woodCost=t.goldCost=t.productionTime=t.unknown=t.health=void 0,t.health=new Uint16Array(new Uint8Array([60,0,60,0,40,0,40,0,120,0,120,0,90,0,90,0,60,0,60,0,40,0,40,0,40,0,40,0,150,0,50,0,40,0,30,0,30,0,60,0,250,0,30,0,150,0,200,0,30,0,40,0,40,0,30,0,44,1,250,0,250,0,250,0,144,1,144,1,32,3,32,3,188,2,188,2,132,3,132,3,196,9,196,9,88,2,88,2,244,1,244,1,32,3,32,3,136,19,136,19,156,99,255,0]).buffer),t.unknown=new Uint8Array([0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),t.productionTime=new Uint8Array([60,60,75,75,100,100,80,80,70,70,90,90,80,80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,100,100,150,150,200,200,200,200,100,100,150,150,150,150,150,150,200,200,150,0]),t.goldCost=new Uint8Array([40,40,40,40,90,90,85,85,45,45,90,90,70,70,250,250,250,250,250,90,0,20,20,150,20,50,10,40,200,0,0,200,50,50,60,60,80,80,140,140,40,40,60,60,100,100,90,90,250,250,0,0]),t.woodCost=new Uint8Array([0,0,0,0,20,20,0,0,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,30,50,50,50,50,30,30,40,40,50,50,40,40,40,40,200,200,10,0]),t.range=new Uint8Array([1,1,1,1,8,8,1,1,5,4,3,2,1,2,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3]),t.armor=new Uint8Array([2,2,0,0,0,0,5,5,1,1,0,0,0,0,0,5,0,0,0,3,0,0,10,0,0,4,1,2,0,0,0,0]),t.damage=new Uint8Array([9,9,0,0,255,255,13,13,0,0,0,0,0,0,0,15,0,0,0,12,0,3,0,40,0,9,4,9,65,0,0,0]),t.armorPiercingDamage=new Uint8Array([1,1,0,0,0,0,1,1,4,5,6,6,6,6,10,1,0,0,0,1,0,1,1,0,3,1,1,1,0,0,0,40])}},t={};!function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,r),n.exports}(473)})();